{% extends 'templateUser.html' %}

{% block content %}


<div class="bg-light rounded-3 mb-4 p-5">
    <div class="container-fluid py-5">
        <h1 class="text-center fw-bold display-5">Welcome Home!</h1>
    </div>
    <div class="row" id="books">
    </div>
</div>

<script>

    fetch("http://localhost:5000/getBooks").then((res) => res.json()).then(res => displayBooks(res));


    function displayBooks(books) {
        const booksHTML = books.map((book) => {

            let html = '<div class="col-10 col-md-6 col-lg-4 my-3">';
            html += '<div class=" border-dark card my-3 p-3" style="width: 20rem;">';
            html += '<div class="">';
            html += `<h4 class='card-title'>Title : ${book.title}</h5>`;
            html += `<h5 class='card-title'>Author : ${book.author}</h5>`;
            html += `<p>Satus: ${book.status}</p>`
            html += `<div class="d-flex justify-content-evenly">`
            html += `<a class="btn btn-primary" href='/displayEditBook?id=${book.id}'>Edit</a>`;
            html += `<button class="btn btn-warning" onclick="confirmDelete(this)" data-id='${book.id}'>Delete</button>'`;
            html += " </div></div></div></div>";
            return html;
        });

        const books_div = document.getElementById("books");

        for (const book of booksHTML) {
            books_div.innerHTML += book;
        }

    }

    function editBook(element) {
        const id = element.getAttribute('data-id');
        getBook(id);
    }

    function getBook(id) {
        fetch("http://localhost:5000/getBookById", {
            headers: {
                'Content-Type': 'application/json'
            },
            method: 'POST',
            body: JSON.stringify({
                id: id
            })
        }).then(res => res.json()).then(res => console.log(res))
    }


    function confirmDelete(element) {


        if (confirm("Are you sure you want to delete this book ?")) {
            const idBook = element.getAttribute('data-id');
            console.log(idBook)


            fetch("http://localhost:5000/deleteBook", {
                headers: {
                    'Content-Type': 'application/json'
                },
                method: 'POST',
                body: JSON.stringify({
                    id: idBook
                })
            }).then(res => res.json()).then(res => console.log(res) )

        }

    }

</script>


{% endblock %}